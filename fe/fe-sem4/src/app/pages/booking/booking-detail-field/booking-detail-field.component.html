<div class="main-containers">
  <h1 class="detail-title">
    Th√¥ng tin chi ti·∫øt s√¢n b√≥ng
  </h1>
  <div class="stadium-container">
    <!-- ·∫¢nh s√¢n v·∫≠n ƒë·ªông -->
    <div class="stadium-image">
      <img [src]="img" alt="Stadium Image" />
    </div>
    <div class="stadium-infor">
      <h1>{{ stadiumDetail.name }}</h1>
      <p class="address">
        <strong>üìç ƒê·ªãa ch·ªâ:</strong> {{ stadiumDetail.address }}
      </p>
      <p class="description">
        <strong>‚ÑπÔ∏è M√¥ t·∫£:</strong> {{ stadiumDetail.description }}
      </p>
      <p><strong>üìß Email:</strong> {{ stadiumDetail.email }}</p>
      <p><strong>üìû S·ªë ƒëi·ªán tho·∫°i:</strong> {{ stadiumDetail.phoneNumber }}</p>
      <div class="booking-options">
        <label class="radio-check">
          <input
            type="radio"
            name="bookingType"
            value="single"
            [(ngModel)]="bookingType"
          />
          ƒê·∫∑t s√¢n l·∫ª
        </label>
        <label class="radio-check">
          <input
            type="radio"
            name="bookingType"
            value="longTerm"
            [(ngModel)]="bookingType"
          />
          ƒê·∫∑t d√†i h·∫°n
        </label>
      </div>
      <div>
        <button class="buttonBook" (click)="openDate()">ƒê·∫∑t s√¢n ngay</button>
      </div>
    </div>
  </div>
  <div class="main-container" *ngIf="isPopup">
    <div class="main-container" *ngIf="scheduleData">
      <div style="display: flex; justify-content: space-between; align-items: center;font-size: 20px;margin-bottom: 12px;padding: 0px 10px;">
        <div></div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <button style="background-color: aliceblue;border-radius: 12px;" (click)="changePage(currentPage - 1)" [disabled]="currentIndex === 0">
            ‚óÄ Tr∆∞·ªõc
          </button>
          <h3 style="margin: 0;">
            T·ª´ {{ scheduleData.calender[0] | date: "dd/MM/yyyy" }} ƒë·∫øn
            {{ scheduleData.calender[1] | date: "dd/MM/yyyy" }}
          </h3>
          <button style="background-color: aliceblue;border-radius: 12px;" (click)="changePage(currentPage + 1)" [disabled]="currentIndex >= scheduleData.timeFrames.length - 1">
            Ti·∫øp ‚ñ∂
          </button>
        </div>
        <div></div>
      </div>

      <table>
        <thead>
          <tr>
            <th>Khung gi·ªù</th>
            <th *ngFor="let frame of scheduleData.timeFrames">
              {{ frame.dateString }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let tf of getAllTimeFrames()">
            <td>{{ timeFramesMap[tf] }}</td>
            <td *ngFor="let frame of scheduleData.timeFrames">
              <ng-container
                *ngIf="getScheduleForTimeFrame(frame, tf) as schedule"
              >
                <div
                  class="choose-field"
                  [ngClass]="{
                selected: isSelected(schedule, frame.date),
              }"
                  (click)="choose(schedule, frame.date)"
                >
                  {{ schedule.price }} (c√≤n {{ schedule.quantity }} s√¢n)
                </div>
              </ng-container>
              <ng-container *ngIf="!getScheduleForTimeFrame(frame, tf)">
                <span>Kh√¥ng c√≥ d·ªØ li·ªáu</span>
              </ng-container>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="selected-fields-container" *ngIf="selectedFields.length > 0">
        <h3>Danh s√°ch s√¢n ƒë√£ ch·ªçn:</h3>
        <table class="selected-fields-table">
          <thead>
            <tr>
              <th>Th·ªùi gian</th>
              <th>S·ªë l∆∞·ª£ng</th>
              <th>Gi√°</th>
              <th>Ng√†y</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let field of selectedFields">
              <td>{{ field.timeFrameStr }}</td>
              <!-- <td>{{ field.quantity }}</td> -->
              <td>
                <input
                  type="number"
                  [(ngModel)]="field.quantity"
                  [min]="1"
                  [max]="field.availableQuantity"
                  (ngModelChange)="onQuantityChange(field)"
                  class="form-control"
                />
              </td>
              <td>{{ field.amount }}</td>
              <td>{{ field.date }}</td>
            </tr>
          </tbody>
        </table>
        <button
          class="payment-btn mt-5"
          (click)="goToPayment()"
          [disabled]="selectedFields.length === 0"
        >
          ƒêi ƒë·∫øn thanh to√°n
        </button>
      </div>
    </div>
  </div>

  <!-- Stadium cards with pagination -->
  <h1 class="section-title mt-5">C√°c s√¢n b√≥ng g·∫ßn ƒë√¢y</h1>

  <div class="stadium-list">
    <div *ngFor="let stadium of paginatedStadiums" class="stadium-card">
      <img [src]="img" alt="ok" />
      <div class="stadium-info">
        <h3>{{ stadium.name }}</h3>
        <p>{{ stadium.address }}</p>
        <!--        <div class="rating">-->
        <!--          <span *ngFor="let star of [].constructor(stadium.rating)">{{ '‚òÖ‚òÖ‚òÖ‚òÖ' }}</span>-->
        <!--        </div>-->
        <div class="rating">
          <ng-container *ngFor="let i of [1, 2, 3, 4, 5]">
            <span class="star" *ngIf="i <= stadium.rating">‚òÖ</span>
            <span class="empty-star" *ngIf="i > stadium.rating">‚òÖ</span>
          </ng-container>
        </div>
      </div>
      <div class="action-buttons">
        <button class="btn-map" (click)="openMapWithCoordinates(stadium.latitude, stadium.longitude)">
          <i class="fas fa-eye"></i> Xem b·∫£n ƒë·ªì
        </button>
        <button class="btn-detail" (click)="viewDetail(stadium.areaId)">
          <i class="fas fa-info-circle"></i> Xem chi ti·∫øt
        </button>
      </div>
    </div>
  </div>
</div>
<div class="popup-overlay" *ngIf="showLongTermPopup" (click)="closePopup()">
  <div class="popup" (click)="$event.stopPropagation()">
    <button class="close-button" (click)="closePopup()">&times;</button>
    <form [formGroup]="longTermForm" (ngSubmit)="onSubmit()">
      <label>Th√°ng:
        <input type="month" formControlName="month" class="input-label-popup" />
      </label>
      <label>S·ªë l∆∞·ª£ng s√¢n:
        <input type="number" formControlName="quantity" class="input-label-popup" min="1" />
      </label>
      <label>Ng√†y trong tu·∫ßn:
        <select formControlName="weekDay" class="input-label-popup">
          <option *ngFor="let day of daysInWeek" [value]="day.value">{{ day.label }}</option>
        </select>
      </label>
      <label>Khung gi·ªù:
        <select formControlName="timeFrame" [disabled]="!!longTermForm.get('timeFrame')?.disabled">
          <option *ngFor="let time of timeFrames" [value]="time.value">{{ time.label }}</option>
        </select>
      </label>
    </form>
    <div class="terms-container">
      <p>
        Xem c√°c ƒëi·ªÅu kho·∫£n c·ªßa s√¢n:
        <a href="#" (click)="showLongTermPopup = true">T·∫°i ƒë√¢y</a>
      </p>
    </div>

    <div class="button-group">
      <button class="submit" (click)="confirmLongTerm()">X√°c nh·∫≠n</button>
      <button class="cancel" (click)="closePopupLong()">ƒê√≥ng</button>
    </div>
  </div>
</div>